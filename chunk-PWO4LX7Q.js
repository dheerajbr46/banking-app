import{a as g}from"./chunk-IKQLUHYN.js";import{e as b}from"./chunk-Z67HQNM4.js";import{A as m,R as u,V as f,_ as U,c as i,k as p,p as d,s as t}from"./chunk-7G2ECGGJ.js";var n="banking-app.token",l="banking-app.user",h=class a{constructor(r){this.http=r}baseUrl="api";currentUserSubject=new p(this.restoreUser());currentUser$=this.currentUserSubject.asObservable();isAuthenticated$=this.currentUser$.pipe(t(r=>!!r));login(r){return this.http.get(`${this.baseUrl}/users`).pipe(t(e=>g(e)),t(e=>e.find(o=>o.email.toLowerCase()===r.email.toLowerCase())),t(e=>{if(!e||e.password!==r.password)throw new Error("Invalid email or password");return e}),u(e=>this.persistSession(e)),t(e=>{let s=e,{password:o}=s;return i(s,["password"])}),m(e=>d(()=>e instanceof Error?e:new Error("Unable to complete login request."))))}logout(){localStorage.removeItem(n),localStorage.removeItem(l),this.currentUserSubject.next(null)}get accessToken(){return localStorage.getItem(n)}persistSession(r){let e=crypto.randomUUID?.()??"mock-token";localStorage.setItem(n,e),localStorage.setItem(l,JSON.stringify({id:r.id,name:r.name,email:r.email}));let s=r,{password:o}=s,c=i(s,["password"]);this.currentUserSubject.next(c)}restoreUser(){let r=localStorage.getItem(l);if(!r)return null;try{return JSON.parse(r)}catch(e){return console.warn("Failed to restore user session:",e),null}}static \u0275fac=function(e){return new(e||a)(U(b))};static \u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})};export{h as a};
