import{a as g}from"./chunk-IKQLUHYN.js";import{e as S}from"./chunk-KHQP2C4F.js";import{B as m,T as u,X as f,aa as U,c as n,k as p,p as d,s as t}from"./chunk-YYSJSBRX.js";var l="banking-app.token",i="banking-app.user",b=class a{constructor(r){this.http=r}baseUrl="api";currentUserSubject=new p(this.restoreUser());currentUser$=this.currentUserSubject.asObservable();isAuthenticated$=this.currentUser$.pipe(t(r=>!!r));login(r){return this.http.get(`${this.baseUrl}/users`).pipe(t(e=>g(e)),t(e=>e.find(o=>o.email.toLowerCase()===r.email.toLowerCase())),t(e=>{if(!e||e.password!==r.password)throw new Error("Invalid email or password");return e}),u(e=>this.persistSession(e)),t(e=>{let s=e,{password:o}=s;return n(s,["password"])}),m(e=>d(()=>e instanceof Error?e:new Error("Unable to complete login request."))))}logout(){localStorage.removeItem(l),localStorage.removeItem(i),this.currentUserSubject.next(null)}updateSessionProfile(r){localStorage.setItem(i,JSON.stringify(r)),this.currentUserSubject.next(r)}get accessToken(){return localStorage.getItem(l)}persistSession(r){let e=crypto.randomUUID?.()??"mock-token";localStorage.setItem(l,e),localStorage.setItem(i,JSON.stringify({id:r.id,name:r.name,email:r.email}));let s=r,{password:o}=s,c=n(s,["password"]);this.currentUserSubject.next(c)}restoreUser(){let r=localStorage.getItem(i);if(!r)return null;try{return JSON.parse(r)}catch(e){return console.warn("Failed to restore user session:",e),null}}static \u0275fac=function(e){return new(e||a)(U(S))};static \u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})};export{b as a};
