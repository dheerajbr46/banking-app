import{e as f,f as h}from"./chunk-O2OYFZXD.js";import{C as o,U as u,Y as g,ba as d,k as c,p as s,s as a}from"./chunk-DEEXOUVC.js";var b={production:!0,apiBaseUrl:"https://your-production-backend.example.com/api"};var p="banking-app.token",l="banking-app.user",U=class m{constructor(e){this.http=e}apiBaseUrl=b.apiBaseUrl;authEndpoint=`${this.apiBaseUrl}/auth`;currentUserSubject=new c(this.restoreUser());currentUser$=this.currentUserSubject.asObservable();isAuthenticated$=this.currentUser$.pipe(a(e=>!!e));login(e){let t={email:e.email.trim().toLowerCase(),password:e.password};return this.http.post(`${this.authEndpoint}/login`,t).pipe(u(i=>this.persistSession(i.token,i.user)),a(i=>this.mapProfile(i.user)),o(i=>s(()=>this.normalizeError(i))))}register(e){let r=e.username.trim(),t=e.email.trim().toLowerCase(),i={username:r,fullName:e.name.trim(),email:t,password:e.password};return this.http.post(`${this.authEndpoint}/register`,i).pipe(a(n=>this.mapProfile(n.user)),o(n=>s(()=>this.normalizeError(n))))}checkUsernameAvailability(e){let r=e.trim();return r?this.http.get(`${this.authEndpoint}/username-availability`,{params:{username:r}}).pipe(a(t=>t.available),o(t=>{let i=this.normalizeError(t),n=i.message==="Unable to sign in."?"Unable to verify username.":i.message;return s(()=>new Error(n))})):s(()=>new Error("Username is required"))}logout(){localStorage.removeItem(p),localStorage.removeItem(l),this.currentUserSubject.next(null)}updateSessionProfile(e){localStorage.setItem(l,JSON.stringify(e)),this.currentUserSubject.next(e)}get accessToken(){return localStorage.getItem(p)}get backendApiBase(){return this.apiBaseUrl}persistSession(e,r){let t=this.mapProfile(r);localStorage.setItem(p,e),localStorage.setItem(l,JSON.stringify(t)),this.currentUserSubject.next(t)}restoreUser(){let e=localStorage.getItem(l);if(!e)return null;try{return JSON.parse(e)}catch(r){return console.warn("Failed to restore user session:",r),null}}mapProfile(e){let r=e.id??e.username??e.email,t=e.name??e.fullName??e.username??e.email.split("@")[0];return{id:String(r),name:t,email:e.email}}normalizeError(e){if(e instanceof f){let r=e.error&&typeof e.error=="object"&&"message"in e.error?String(e.error.message):e.message;return new Error(r||"Unable to sign in.")}return e instanceof Error?e:new Error("Unable to sign in.")}static \u0275fac=function(r){return new(r||m)(d(h))};static \u0275prov=g({token:m,factory:m.\u0275fac,providedIn:"root"})};export{b as a,U as b};
